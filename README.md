# UNI'S ON AIR Speed Tracker

UNI'S ON AIRのランキング画面を自動で監視し、時速（ポイント変化率）を計測・追跡するツールです。Gemini AIでデータを抽出し、1h、6h、12h、24hの時間別ポイント変化を分析してDiscordに投稿します。

## ✨ 新機能

- **🖱️ GUI対応**: 直感的なグラフィカルユーザーインターフェース
- **📊 時速表示**: 1h、6h、12h、24h の時間別ポイント変化を表示
- **🎯 ドラッグ選択**: マウスでスクリーン領域を簡単選択
- **🔄 7つの領域対応**: Region 0-6まで対応（Region 0は自動フルスクリーン）
- **🏷️ カスタム領域名**: Region 1-6の名前を自由にカスタマイズ可能
- **✅ 領域ON/OFF**: 各領域を個別に有効/無効切り替え
- **💾 データ出力**: JSON/CSV形式でデータを保存

## 🚀 セットアップ

### 1. 前提条件

- Go 1.21以上
- Windows環境（スクリーンショット機能のため）
- **Androidエミュレータ**（BlueStacks、NoxPlayer、LDPlayer等）
- **ユニゾンエアー**アプリ（エミュレータ内にインストール）

### 2. Androidエミュレータとユニゾンエアーの準備

1. **エミュレータのインストール**
   - BlueStacks、NoxPlayer、LDPlayer等のAndroidエミュレータをインストール
   - エミュレータを起動し、安定して動作することを確認

2. **ユニゾンエアーのセットアップ**
   - エミュレータ内でGoogle Play StoreまたはAPKから「ユニゾンエアー」をインストール
   - アプリを起動し、ログイン
   - **ランキング画面を表示**（重要：この画面がスクリーンショット対象）
   - **推奨**: エミュレータ付属のスクリプト機能を使用してランキング画面への遷移を自動化

3. **エミュレータスクリプトの設定（推奨）**
   - エミュレータ付属のマクロ/スクリプト機能を使用
   - ユニゾンエアー起動 → ランキング画面表示までの操作を記録・自動化
   - 定期的なランキング画面更新の自動化
   - **将来対応予定**: 本ツールからエミュレータスクリプトを連携実行

4. **画面配置の調整**
   - エミュレータのウィンドウサイズを調整
   - ランキング表示が見やすいサイズに設定
   - 他のウィンドウに隠れないよう配置

### 3. 依存関係のインストール

```bash
go mod tidy
```

### 4. 環境変数の設定

`.env.example`をコピーして`.env`ファイルを作成し、必要なAPIキーを設定してください：

```bash
copy .env.example .env
```

`.env`ファイルを編集して以下の値を設定：
- `GEMINI_API_KEY`: Google Gemini APIキー（**必須**）
- `DISCORD_WEBHOOK_0~6`: Discord WebhookのURL（オプション）
- `DESIRED_MINUTES`: 実行タイミング（分）をカンマ区切りで指定（例: 1,15,30,45）
- `REGION_1_NAME~REGION_6_NAME`: 各領域のカスタム名（オプション）
- `REGION_1_ENABLED~REGION_6_ENABLED`: 各領域の有効/無効設定（オプション）

### 5. 設定ファイル

`config.json`ファイルで名前の置換設定を行います：

```json
{
  "name_replaces": {
    "誤認識される名前": "正しい名前"
  }
}
```

## 📁 ファイル構成

- `main.go`: メインプログラム
- `go.mod`: Go モジュール定義
- `config.json.example`: 設定ファイルのテンプレート（名前置換設定）
- `.env.example`: 環境変数のテンプレート（APIキーなど）
- `README.md`: このファイル
- `res/`: 出力ディレクトリ（スクリーンショット、JSON、CSV）

## 🎯 使用方法

### GUIモード（推奨）

```bash
go run main.go
```

またはビルドして実行：

```bash
go build -o unisonair-speed-tracker.exe
./unisonair-speed-tracker.exe
```

### GUI操作手順

**⚠️ 事前準備**: 
- Androidエミュレータでユニゾンエアーのランキング画面を開いておく
- エミュレータスクリプトでランキング画面更新を自動化しておく（推奨）

1. **設定入力**
   - Gemini API Keyを入力（必須）
   - Discord Webhook URLを入力（オプション）
   - 実行タイミングを設定（例: 1,15,30,45）

2. **領域設定**
   - Region 0: 自動でフルスクリーン検出（「更新」ボタンで再検出）
   - Region 1-6: 
     - カスタム名を入力（例: "総合ランキング", "推しランキング"など）
     - 「有効」チェックボックスで個別制御
     - 「選択」ボタンでエミュレータ画面をドラッグ選択、または座標を手動入力

3. **実行**
   - 「設定保存」で設定保存（カスタム名とタブ名が連動更新）
   - 「開始」でスケジュール実行開始
   - ログでリアルタイム状況確認
   - 各領域のタブでランキングデータをリアルタイム表示

### CLIモード

```bash
go run main.go --cli
```

### 出力ファイル

実行後、以下にファイルが生成されます：
- `res/{region}/screenshot/`: スクリーンショット画像
- `res/{region}/json/datas.json`: 抽出データ（JSON形式）
- `res/{region}/csv/datas.csv`: 分析データ（CSV形式）

## 🔧 主要機能

### 📸 スクリーンショット機能
- **7つの領域対応**: Region 0（全画面自動）+ Region 1-6（カスタマイズ可能）
- **カスタム領域名**: 各領域に分かりやすい名前を設定可能
- **領域ON/OFF制御**: 各領域を個別に有効/無効切り替え
- **ドラッグ選択**: マウスで領域を簡単指定
- **自動スケジュール実行**: 指定した分（例: 1,15,30,45分）に自動実行

### 🤖 AI解析機能  
- **Gemini AI OCR**: Google Gemini 1.5 Flash でランキング情報を抽出
- **名前置換**: OCR誤認識を設定ファイルで自動修正
- **時速計算**: 1h、6h、12h、24h の時間別ポイント変化を表示

### 💾 データ管理
- **JSON保存**: 取得データを構造化して保存
- **CSV出力**: スプレッドシート用にCSV形式で出力
- **Discord連携**: 各領域専用のWebhookで結果を自動投稿
- **ファイル操作**: GUIから直接CSV/JSONファイルを開いて確認可能

### 🖥️ ユーザーインターフェース
- **日本語GUI**: 直感的な日本語グラフィカルインターフェース
- **タブ表示**: 各領域のランキングデータを独立したタブで表示
- **設定保存**: .envファイルで設定を永続化
- **リアルタイムログ**: 実行状況をリアルタイム表示
- **ファイル連携**: 設定ファイルやデータファイルを直接開けるボタン

## 🆕 最新アップデート

### Region 5 & 6 対応
- **拡張された領域**: Region 1-4 から Region 1-6 に拡張
- **追加WebHook**: Discord Webhook 5, 6 を追加で設定可能
- **柔軟な配置**: より多くの画面領域を同時監視

### カスタム領域名機能
- **わかりやすい名前**: 各領域に「松田好花」「総合」などの名前を設定
- **タブ名連動**: 設定した名前がタブタイトルに自動反映
- **設定永続化**: カスタム名は.envファイルに保存され次回起動時も維持

### 領域制御機能
- **個別ON/OFF**: 各領域を「有効」チェックボックスで個別制御
- **効率的処理**: 無効にした領域はスキップされ処理負荷を軽減
- **動的調整**: 実行中でも次回実行時から設定が反映

### 日本語UI完全対応
- **統一された日本語表示**: すべてのボタンとラベルが日本語
- **直感的操作**: 「開始」「停止」「選択」「更新」など分かりやすい表記
- **ファイル操作**: 「CSV を開く」「JSON を開く」でデータ確認が簡単

## 🔮 今後の予定

### エミュレータ連携自動化
- **スクリプト実行**: 本ツールからエミュレータのマクロ/スクリプトを直接実行
- **画面更新自動化**: スクリーンショット取得前に自動でランキング画面を更新

## 🛠️ トラブルシューティング

### よくあるエラー
- `GEMINI_API_KEY environment variable is not set`: `.env`ファイルにAPIキーが設定されていません
- `failed to capture screenshot`: スクリーンショット権限がない、または画面が見つかりません
- `Discord webhook failed`: Webhook URLが無効またはDiscordサーバーに接続できません
- **ランキングデータが取得できない**: エミュレータでユニゾンエアーのランキング画面が表示されているか確認
- **領域選択がずれる**: エミュレータの表示倍率や位置を調整してから再度領域選択

### パフォーマンス改善
- エミュレータの画面解像度を高めに設定（OCR精度向上のため）
- ランキング表示部分が鮮明に見えるようエミュレータの表示サイズを調整
- Gemini API呼び出し頻度に注意してください（レート制限があります）
- 不要な領域は「有効」のチェックを外して処理負荷を軽減

## 🔒 セキュリティ

以下のファイルには機密情報が含まれているため、Gitリポジトリには追加しないでください：
- `.env` - APIキーが含まれる
- `config.json` - 個人設定が含まれる
- `res/` ディレクトリ内の生成ファイル

## 📚 GitHub設定推奨

**リポジトリ名**: `unisonair-speed-tracker`  
**説明**: "UNI'S ON AIR ranking speed tracker with Gemini AI OCR and Discord integration"  
**トピック**: `unisonair`, `ranking`, `speed-tracker`, `gemini-ai`, `discord`, `golang`, `gui`